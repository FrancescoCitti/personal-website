{{ define "main" }}
<h1>{{ .Title }}</h1>
<p class="album-description">{{ .Content }}</p>

<!-- Masonry Grid -->
<div class="photo-gallery">
    {{ range .Resources.ByType "image" }}
    <img class="gallery-img lazyload" data-src="{{ .RelPermalink }}" alt="Photo" loading="lazy">
    {{ else }}
    <p style="color: red;">No images found in this album.</p>
    {{ end }}
</div>

<!-- Lightbox Overlay -->
<div id="lightbox" class="lightbox hidden">
    <span class="close-btn" onclick="closeLightbox()">Ã—</span>
    <img id="lightbox-img" src="" alt="Lightbox Image" draggable="false" oncontextmenu="return false;">
    <div class="counter" id="counter"></div>
    <div class="nav-btn prev" onclick="prevImage()">&#10094;</div>
    <div class="nav-btn next" onclick="nextImage()">&#10095;</div>
</div>

<!-- ðŸ“Œ CSS Enhancements -->
<style>
    /* ðŸ”¹ Ensure images fade in smoothly */
    .lazyload {
        opacity: 0;
        filter: blur(10px);
        transition: opacity 0.5s ease-in-out, filter 0.5s ease-in-out;
    }
    .lazyloaded {
        opacity: 1;
        filter: blur(0);
    }

    .photo-gallery {
        display: column-count;
        column-count: 4;
        column-gap: 15px;
        margin: 20px auto;
        max-width: 90vw;
    }

    /* ðŸ”¹ Mobile & Tablet Adjustments */
    @media (max-width: 1024px) { .photo-gallery { column-count: 4; } }
    @media (max-width: 768px) { .photo-gallery { column-count: 3; } }
    @media (max-width: 480px) { .photo-gallery { column-count: 2; } }

    .photo-gallery img {
        width: 100%;
        display: block;
        margin-bottom: 15px;
        border-radius: 8px;
        cursor: pointer;
        transition: transform 0.2s ease-in-out;
    }

    .photo-gallery img:hover {
        transform: scale(1.05);
    }

    .album-description {
        text-align: justify;
        font-size: 22px;
        line-height: 1.8;
        max-width: 90vw; /* Matches the width of the photo gallery */
        margin: 0 auto 30px auto; /* Centers it */
        padding: 0; /* Removes unnecessary padding */
        color: white; /* Adjust color if needed */
    }

</style>

<!-- âœ… Lazy Load + Lightbox + Arrow Key Navigation -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const images = document.querySelectorAll(".lazyload");
        const lightbox = document.getElementById("lightbox");
        const lightboxImg = document.getElementById("lightbox-img");
        const counter = document.getElementById("counter");
        let currentIndex = 0;

        // ðŸ”¹ Lazy Load Images on Scroll
        const observer = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    let img = entry.target;
                    img.src = img.getAttribute("data-src");
                    img.classList.remove("lazyload");
                    img.classList.add("lazyloaded");
                    observer.unobserve(img);
                }
            });
        }, { rootMargin: "50px" });

        images.forEach(img => observer.observe(img));

        // ðŸ”¹ Lightbox Functions
        function openLightbox(index) {
            document.body.classList.add("lightbox-open");
            currentIndex = index;
            lightboxImg.src = images[currentIndex].getAttribute("data-src");
            counter.textContent = (currentIndex + 1) + " / " + images.length;
            lightbox.classList.add("visible");
        }

        function closeLightbox() {
            document.body.classList.remove("lightbox-open");
            lightbox.classList.remove("visible");
        }

        function nextImage() {
            if (currentIndex < images.length - 1) {
                currentIndex++;
                openLightbox(currentIndex);
            }
        }

        function prevImage() {
            if (currentIndex > 0) {
                currentIndex--;
                openLightbox(currentIndex);
            }
        }

        images.forEach((img, index) => {
            img.addEventListener("click", () => openLightbox(index));
        });

        document.querySelector(".close-btn").addEventListener("click", closeLightbox);
        document.querySelector(".next").addEventListener("click", nextImage);
        document.querySelector(".prev").addEventListener("click", prevImage);
        lightbox.addEventListener("click", (e) => {
            if (!e.target.closest(".nav-btn") && e.target !== lightboxImg) {
                closeLightbox();
            }
        });

        // ðŸ”¹ Allow Navigation with Arrow Keys
        document.addEventListener("keydown", (e) => {
            if (lightbox.classList.contains("visible")) {
                if (e.key === "ArrowRight") nextImage();
                if (e.key === "ArrowLeft") prevImage();
                if (e.key === "Escape") closeLightbox();
            }
        });
    });
</script>
{{ end }}
