{{ define "main" }}
<h1>{{ .Title }}</h1>
<p class="album-description">{{ .Content }}</p>
<<!-- üìå Photo Gallery -->
<div class="photo-gallery">
    {{ range .Resources.ByType "image" }}
    <img class="gallery-img lazyload" data-src="{{ .RelPermalink }}" alt="Photo" loading="lazy">
    {{ else }}
    <p style="color: red;">No images found in this album.</p>
    {{ end }}
</div>

<!-- üìå Lightbox Overlay -->
<div id="lightbox" class="lightbox hidden">
    <span class="close-btn" onclick="closeLightbox()">√ó</span>
    <img id="lightbox-img" src="" alt="Lightbox Image" draggable="false" oncontextmenu="return false;">
    <div class="counter" id="counter"></div>
    <div class="nav-btn prev" onclick="prevImage()">&#10094;</div>
    <div class="nav-btn next" onclick="nextImage()">&#10095;</div>
</div>

<!-- üìå CSS Fixes -->
<style>
    /* üîπ Smooth Lazy Loading */
    .lazyload {
        opacity: 0;
        transition: opacity 0.5s ease-in-out;
    }
    .lazyloaded {
        opacity: 1;
    }

    .photo-gallery {
        display: column-count;
        column-count: 4;
        column-gap: 15px;
        margin: 20px auto;
        max-width: 90vw;
    }

    .photo-gallery img {
        width: 100%;
        display: block;
        margin-bottom: 15px;
        border-radius: 8px;
        cursor: pointer;
        transition: transform 0.2s ease-in-out;
    }

    .photo-gallery img:hover {
        transform: scale(1.05);
    }

    /* üîπ Lightbox Styling */
.lightbox {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.90);
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    visibility: hidden;
    opacity: 0;
    transition: opacity 0.2s ease-in-out, visibility 0.2s;
    z-index: 9999;
}

.lightbox.visible {
    visibility: visible;
    opacity: 1;
}

/* üîπ Lightbox Image */
.lightbox img {
    max-width: 85vw;
    max-height: 85vh;
    border-radius: 10px;
}

/* üîπ Close (X) Button */
.lightbox .close-btn {
    position: absolute;
    top: 25px;
    right: 40px;
    font-size: 50px; /* ‚¨ÜÔ∏è Increased size */
    color: white;
    cursor: pointer;
    background: rgba(0, 0, 0, 0.6);
    padding: 10px;
    border-radius: 50%;
    transition: background 0.2s ease-in-out;
}

.lightbox .close-btn:hover {
    background: rgba(255, 255, 255, 0.3); /* ‚ùå Rimosso il rosso */
}

/* üîπ Navigation Arrows */
.lightbox .nav-btn {
    position: absolute;
    top: 50%; /* ‚úÖ Centered vertically */
    transform: translateY(-50%); /* ‚úÖ Aligns with image center */
    font-size: 60px; /* ‚¨ÜÔ∏è Increased size */
    color: white;
    cursor: pointer;
    user-select: none;
    padding: 15px;
    background: rgba(0, 0, 0, 0.5);
    border-radius: 50%;
    transition: background 0.2s ease-in-out;
}

.lightbox .nav-btn:hover {
    background: rgba(255, 255, 255, 0.3);
}

.lightbox .prev { left: 30px; } /* ‚¨ÖÔ∏è Left Arrow */
.lightbox .next { right: 30px; } /* ‚û°Ô∏è Right Arrow */

/* üîπ Image Counter */
.lightbox .counter {
    position: absolute;
    bottom: 20px;
    color: white;
    font-size: 18px;
    background: rgba(0, 0, 0, 0.6);
    padding: 5px 15px;
    border-radius: 6px;
}

</style>

<!-- üìå JavaScript Fix -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const images = document.querySelectorAll(".gallery-img");
        const lightbox = document.getElementById("lightbox");
        const lightboxImg = document.getElementById("lightbox-img");
        const counter = document.getElementById("counter");
        let currentIndex = 0;

        // üîπ Lazy Load Observer
        if ("IntersectionObserver" in window) {
            const observer = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        let img = entry.target;
                        img.src = img.getAttribute("data-src");
                        img.classList.add("lazyloaded");
                        img.removeAttribute("data-src"); // Clean up
                        observer.unobserve(img);
                    }
                });
            }, { rootMargin: "50px" });

            images.forEach(img => observer.observe(img));
        } else {
            // üîπ Fallback for Older Browsers
            images.forEach(img => {
                img.src = img.getAttribute("data-src");
                img.classList.add("lazyloaded");
            });
        }

        // üîπ Lightbox Functions
        function openLightbox(index) {
            currentIndex = index;
            lightboxImg.src = images[currentIndex].src;
            counter.textContent = (currentIndex + 1) + " / " + images.length;
            lightbox.classList.add("visible");
        }

        function closeLightbox() {
            lightbox.classList.remove("visible");
        }

        function nextImage() {
            if (currentIndex < images.length - 1) {
                currentIndex++;
                openLightbox(currentIndex);
            }
        }

        function prevImage() {
            if (currentIndex > 0) {
                currentIndex--;
                openLightbox(currentIndex);
            }
        }

        // üîπ Attach Click Events to Images
        images.forEach((img, index) => {
            img.addEventListener("click", () => openLightbox(index));
        });

        document.querySelector(".close-btn").addEventListener("click", closeLightbox);
        document.querySelector(".next").addEventListener("click", nextImage);
        document.querySelector(".prev").addEventListener("click", prevImage);
        lightbox.addEventListener("click", (e) => {
            if (!e.target.closest(".nav-btn") && e.target !== lightboxImg) {
                closeLightbox();
            }
        });

        // üîπ Allow Navigation with Arrow Keys
        document.addEventListener("keydown", (e) => {
            if (lightbox.classList.contains("visible")) {
                if (e.key === "ArrowRight") nextImage();
                if (e.key === "ArrowLeft") prevImage();
                if (e.key === "Escape") closeLightbox();
            }
        });
    });
</script>

{{ end }}
